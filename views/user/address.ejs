<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Addresses</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --page-bg: #dba39a;
      --card-bg: #ffffff;
      --sidebar-bg: #fff5f2;
      --accent-brown: #5c2823;
      --btn-green: #108565;
      --btn-green-hover: #0d6e53;
      --tag-bg: #cbf3e3;
      --tag-text: #0b5e48;
    }

    * {
      box-sizing: border-box;
      font-family: 'Outfit', sans-serif;
    }

    body {
      margin: 0;
      background: var(--page-bg);
    }

    .dashboard-container {
      display: flex;
      width: 98%;
      height: 85vh;
      margin: 20px auto;
      background: white;
      border-radius: 25px;
      overflow: hidden;
    }

    .sidebar-area {
      width: 260px;
      background: var(--sidebar-bg);
      padding: 25px;
    }

    .main-content {
      flex: 1;
      padding: 30px 40px;
      overflow-y: auto;
    }

    .address-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .btn-add-address {
      background: var(--btn-green);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .address-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .address-card {
      background: #f6fcf9;
      border-radius: 15px;
      padding: 20px;
      display: flex;
      justify-content: space-between;
    }

    .contact-info {
      font-weight: 700;
      margin-bottom: 6px;
    }

    .address-text {
      color: #555;
      margin-bottom: 10px;
    }

    .tag {
      background: var(--tag-bg);
      color: var(--tag-text);
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .delete {
      color: red;
      text-decoration: none;
      font-weight: 600;
    }

    /* Drop down */
    .menu-wrapper {
  position: relative;
}

.menu-icon {
  cursor: pointer;
  font-size: 18px;
  color: #555;
}

.menu-dropdown {
  position: absolute;
  top: 25px;
  right: 0;
  background: white;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  display: none;
  min-width: 120px;
  overflow: hidden;
  z-index: 100;
}

.menu-dropdown a {
  display: block;
  padding: 10px 14px;
  text-decoration: none;
  color: #333;
  font-weight: 500;
}

.menu-dropdown a:hover {
  background: #f2f2f2;
}

.menu-dropdown .delete {
  color: red;
}

  </style>
</head>

<body>

  <!-- Header -->
  <%- include("../../views/partials/user/h2") %>

  <div class="dashboard-container">

    <!-- Sidebar -->
    <aside class="sidebar-area">
      <%- include("../../views/partials/user/sider") %>
    </aside>

    <!-- Main -->
    <main class="main-content">

      <div class="address-header">
        <h2>Manage Addresses</h2>
        <a href="/add-address">
          <button class="btn-add-address">Add Address</button>
        </a>
      </div>

      <!-- ADDRESS LIST -->
      <div class="address-list">

        <% if (!addresses || addresses.length === 0) { %>
          <p>No address added yet.</p>
        <% } else { %>

          <% addresses.forEach(address => { %>
            <div class="address-card">

              <div>
                <div class="contact-info">
                  <%= address.name %> - <%= address.phone %>
                </div>

                <div class="address-text">
                  <%= address.street %>, <%= address.city %><br>
                  <%= address.state %> - <%= address.pincode %>
                </div>

                <span class="tag"><%= address.type %></span>
              </div>

              <div class="menu-wrapper">
                <i class="fa-solid fa-ellipsis-vertical menu-icon"
                  onclick="toggleMenu('<%= address._id %>')"></i>

                <div class="menu-dropdown" id="menu-<%= address._id %>">
                  <a href="/address/edit/<%= address._id %>">Edit</a>
                  <a href="javascript:void(0)"
                    class="delete"
                    onclick="openDeleteModal('<%= address._id %>')">
                    Delete
                  </a>

                </div>
              </div>


            </div>
          <% }) %>

        <% } %>

      </div>

    </main>
  </div>


  <!-- DELETE CONFIRMATION MODAL -->
<div id="deleteModal" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  align-items:center;
  justify-content:center;
  z-index:200;
">

  <div style="
    background:white;
    padding:25px;
    border-radius:12px;
    width:320px;
    text-align:center;
  ">
    <h3 style="margin-bottom:10px;">Delete Address?</h3>
    <p style="color:#555;">Are you sure you want to delete this address?</p>

    <div style="margin-top:20px; display:flex; justify-content:space-between;">
      <button onclick="closeDeleteModal()"
        style="padding:8px 20px; border-radius:6px; border:1px solid #ccc;">
        Cancel
      </button>

      <button onclick="confirmDelete()"
        style="padding:8px 20px; border-radius:6px; background:red; color:white; border:none;">
        Delete
      </button>
    </div>
  </div>
</div>

<!-- modal script -->
<script>
  let deleteAddressId = null;

  function openDeleteModal(id) {
    deleteAddressId = id;
    document.getElementById("deleteModal").style.display = "flex";

    // close any open dropdown
    document.querySelectorAll('.menu-dropdown')
      .forEach(menu => menu.style.display = 'none');
  }

  function closeDeleteModal() {
    deleteAddressId = null;
    document.getElementById("deleteModal").style.display = "none";
  }

  function confirmDelete() {
    if (deleteAddressId) {
      window.location.href = `/address/delete/${deleteAddressId}`;
    }
  }
</script>
<!-- drop down for edit / delete -->
  <script>
  function toggleMenu(id) {
    document.querySelectorAll('.menu-dropdown').forEach(menu => {
      if (menu.id !== 'menu-' + id) {
        menu.style.display = 'none';
      }
    });

    const menu = document.getElementById('menu-' + id);
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
  }

  // Close dropdown when clicking outside
  document.addEventListener('click', function (e) {
    if (!e.target.classList.contains('menu-icon')) {
      document.querySelectorAll('.menu-dropdown')
        .forEach(menu => menu.style.display = 'none');
    }
  });
</script>

</body>
</html>
